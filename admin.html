<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Panel - Shree Ram Travels</title>
  <link rel="icon" href="assets/icons/favicon.ico">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/tailwind.css">
  <style>
    /* ‚îÄ‚îÄ Login modal blur overlay ‚îÄ‚îÄ */
    #admin-login-modal {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      /* frosted-glass backdrop */
      background: rgba(15, 23, 42, 0.55);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    #admin-login-modal.active { display: flex; }

    .modal-content {
      background: white;
      padding: 2.5rem 2rem;
      border-radius: 16px;
      box-shadow: 0 24px 64px rgba(0,0,0,0.35);
      max-width: 90%;
      width: 400px;
      animation: modalPop 0.25s ease;
    }
    @keyframes modalPop {
      from { transform: scale(0.92); opacity: 0; }
      to   { transform: scale(1);    opacity: 1; }
    }

    .modal-logo {
      display: flex;
      justify-content: center;
      margin-bottom: 1.25rem;
    }
    .lock-icon {
      width: 56px; height: 56px;
      background: linear-gradient(135deg,#667eea,#764ba2);
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 1.6rem;
      box-shadow: 0 4px 16px rgba(102,126,234,0.4);
    }

    /* ‚îÄ‚îÄ blurred page body behind modal ‚îÄ‚îÄ */
    body.modal-open .admin-page-content { filter: blur(4px); pointer-events: none; }

    /* ‚îÄ‚îÄ Route Selector ‚îÄ‚îÄ */
    #route-selector {
      width: 100%; padding: 0.75rem;
      font-size: 1rem; border: 2px solid #e5e7eb;
      border-radius: 8px; background: white; transition: all 0.2s;
    }
    #route-selector:focus { outline: none; border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59,130,246,0.1); }

    #pricing-status .alert { padding: 1rem; border-radius: 8px; margin-bottom: 0; }
    #pricing-status .alert-info     { background: #dbeafe; border: 1px solid #93c5fd; color: #1e40af; }
    #pricing-status .alert-secondary{ background: #f3f4f6; border: 1px solid #d1d5db; color: #374151; }

    .pricing-info-box {
      background: linear-gradient(135deg,#667eea,#764ba2);
      color: white; padding: 1.5rem; border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-top: 1rem;
    }
    .pricing-info-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; font-size: 1rem; font-weight: 600; }
    .pricing-info-header .badge { padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 600; }
    .badge-success   { background: #10b981; color: white; }
    .badge-secondary { background: rgba(255,255,255,0.2); color: white; }

    .pricing-grid { display: grid; grid-template-columns: repeat(auto-fit,minmax(280px,1fr)); gap: 1.5rem; margin-bottom: 1rem; }
    .pricing-item { display: flex; flex-direction: column; gap: 0.25rem; }
    .pricing-label { font-size: 0.875rem; opacity: 0.9; }
    .pricing-value { font-size: 1.5rem; font-weight: 700; }
    .pricing-note  { padding-top: 1rem; border-top: 1px solid rgba(255,255,255,0.2); opacity: 0.9; font-size: 0.875rem; }

    .pricing-card { border-radius: 12px; padding: 1.5rem; border: 2px solid; transition: all 0.3s ease; }
    .pricing-card:hover { transform: translateY(-4px); box-shadow: 0 8px 16px rgba(0,0,0,0.1); }
    .pricing-card-blue   { background: #eff6ff; border-color: #3b82f6; }
    .pricing-card-gray   { background: #f9fafb; border-color: #6b7280; }
    .pricing-card-green  { background: #f0fdf4; border-color: #10b981; }
    .pricing-card-orange { background: #fffbeb; border-color: #f59e0b; }

    .pricing-card-header { display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem; padding-bottom: 0.75rem; border-bottom: 1px solid rgba(0,0,0,0.1); }
    .pricing-icon { font-size: 1.5rem; }
    .pricing-card-header h4 { margin: 0; font-size: 1.125rem; font-weight: 600; }
    .pricing-card-body label { display: block; margin-bottom: 0.5rem; font-weight: 500; font-size: 0.875rem; }

    .pricing-input { width: 100%; padding: 0.75rem; font-size: 1.25rem; font-weight: 600; border: 2px solid #e5e7eb; border-radius: 8px; text-align: center; transition: all 0.2s; }
    .pricing-input:focus { outline: none; border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59,130,246,0.1); }
    .pricing-help    { display: block; margin-top: 0.5rem; font-size: 0.75rem; color: #6b7280; line-height: 1.4; }
    .pricing-example { margin-top: 0.75rem; padding: 0.5rem; background: rgba(0,0,0,0.05); border-radius: 6px; font-size: 0.875rem; font-style: italic; text-align: center; }

    .pricing-preview { margin: 2rem 0; padding: 1.5rem; background: linear-gradient(135deg,#f9fafb,#ffffff); border-radius: 12px; border: 2px solid #e5e7eb; }

    .alert { padding: 1rem; border-radius: 6px; margin-bottom: 1rem; }
    .alert-info { background: #eff6ff; border-left: 4px solid #3b82f6; color: #1e40af; }
    .alert strong { display: block; margin-bottom: 0.5rem; }

    .form-actions { display: flex; gap: 1rem; justify-content: center; margin-top: 2rem; padding-top: 2rem; border-top: 2px solid #e5e7eb; flex-wrap: wrap; }

    .btn { padding: 0.75rem 1.5rem; border-radius: 6px; font-weight: 500; cursor: pointer; border: none; transition: all 0.3s ease; display: inline-flex; align-items: center; gap: 0.5rem; }
    .btn-primary   { background: linear-gradient(135deg,#667eea,#764ba2); color: white; }
    .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(102,126,234,0.4); }
    .btn-secondary { background: #6b7280; color: white; }
    .btn-secondary:hover { background: #4b5563; }
    .btn-outline   { background: white; border: 2px solid #e5e7eb; color: #374151; }
    .btn-outline:hover { border-color: #667eea; color: #667eea; }
    .btn-success   { background: #10b981; color: white; }
    .btn-success:hover { background: #059669; transform: translateY(-1px); }
    .btn-block { width: 100%; justify-content: center; }

    .card { background: white; padding: 2rem; border-radius: 0.75rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
    .card-header h3 { font-size: 1.25rem; font-weight: 600; color: var(--secondary); margin-bottom: 0.5rem; }
    .card-description { color: var(--slate-600); margin-bottom: 1.5rem; font-size: 0.875rem; }
    .card-body { margin-top: 1rem; }
    .form-group { margin-bottom: 1.5rem; }
    .form-group label { display: block; margin-bottom: 0.5rem; font-weight: 500; color: var(--secondary); }
    .form-control { width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 1rem; transition: all 0.2s; }
    .form-control:focus { outline: none; border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59,130,246,0.1); }
    .form-help { display: block; margin-top: 0.5rem; font-size: 0.875rem; color: #6b7280; }

    .tab-header { margin-bottom: 2rem; }
    .tab-header h2 { font-size: 1.75rem; font-weight: 700; color: var(--secondary); margin-bottom: 0.5rem; }
    .tab-description { color: var(--slate-600); font-size: 1rem; }
    .required { color: #ef4444; }

    /* Download Excel button area */
    .bookings-toolbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 1rem;
      margin-bottom: 1.25rem;
    }

    /* Export modal */
    #export-modal {
      position: fixed; inset: 0; z-index: 9998;
      display: none; align-items: center; justify-content: center;
      background: rgba(15,23,42,0.5);
      backdrop-filter: blur(6px);
    }
    #export-modal.active { display: flex; }
    .export-modal-box {
      background: white; border-radius: 16px;
      padding: 2rem; width: 420px; max-width: 94vw;
      box-shadow: 0 20px 60px rgba(0,0,0,0.25);
      animation: modalPop 0.2s ease;
    }
    .export-modal-box h3 { font-size: 1.2rem; font-weight: 700; margin-bottom: 0.25rem; }
    .export-modal-box p  { color: #6b7280; font-size: 0.875rem; margin-bottom: 1.5rem; }
    .export-option { display: flex; flex-direction: column; gap: 0.75rem; margin-bottom: 1.5rem; }
    .export-option label {
      display: flex; align-items: flex-start; gap: 0.75rem;
      padding: 0.875rem 1rem; border: 2px solid #e5e7eb;
      border-radius: 10px; cursor: pointer; transition: all 0.2s;
    }
    .export-option label:hover { border-color: #667eea; background: #f5f3ff; }
    .export-option input[type=radio] { margin-top: 3px; accent-color: #667eea; }
    .export-option .opt-label { font-weight: 600; font-size: 0.9rem; color: #1e293b; }
    .export-option .opt-desc  { font-size: 0.8rem; color: #64748b; }
    #export-filter-fields { display: none; margin-bottom: 1rem; }
    #export-filter-fields.visible { display: block; }

    @media(max-width:768px){
      .pricing-grid { grid-template-columns: 1fr; }
      .form-actions { flex-direction: column; }
      .form-actions button { width: 100%; }
      .bookings-toolbar { flex-direction: column; align-items: flex-start; }

      /* Horizontal scroll for all admin tables on mobile */
      .table-container {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        border-radius: 10px;
      }
      .table {
        min-width: 680px;
        width: 100%;
      }
    }

    /* ‚îÄ‚îÄ Admin per-seat map ‚îÄ‚îÄ */
    .admin-seat-grid { display: flex; flex-direction: column; gap: 0.5rem; }
    .admin-seat-row  { display: flex; align-items: center; gap: 0.5rem; }
    .admin-aisle     { width: 1.5rem; flex-shrink: 0; }
    .admin-seat-empty { width: 90px; flex-shrink: 0; }
    .admin-seat-input-wrap {
      width: 90px; flex-shrink: 0;
      background: white; border: 1.5px solid #e5e7eb; border-radius: 8px;
      padding: 0.3rem 0.4rem; text-align: center;
    }
    .admin-seat-input-wrap:hover { border-color: #8b5cf6; }
    .admin-seat-label { font-size: 0.7rem; font-weight: 600; color: #374151; margin-bottom: 2px; }
    .admin-seat-price-input {
      width: 100%; border: none; outline: none; text-align: center;
      font-size: 0.85rem; font-weight: 600; color: #1e293b;
      background: transparent; padding: 2px 0;
    }
    .admin-seat-price-input::placeholder { color: #94a3b8; font-weight: 400; }
    /* ‚îÄ‚îÄ User deck tabs ‚îÄ‚îÄ */
    .deck-tabs { display: flex; gap: 0.5rem; margin-bottom: 1.5rem; }
    .deck-tab-btn {
      flex: 1; padding: 0.75rem 1rem; border-radius: 10px;
      border: 2px solid #e5e7eb; background: white;
      font-size: 0.95rem; font-weight: 600; color: #374151;
      cursor: pointer; transition: all 0.2s;
    }
    .deck-tab-btn.active {
      background: linear-gradient(135deg,#667eea,#764ba2);
      color: white; border-color: transparent;
      box-shadow: 0 4px 12px rgba(102,126,234,0.35);
    }
    /* ‚îÄ‚îÄ New seat styles ‚îÄ‚îÄ */
    .seat-grid-new { display: flex; flex-direction: column; gap: 0.6rem; padding: 1rem; }
    .seat-row-new  { display: flex; align-items: center; gap: 0.5rem; }
    .seat-empty    { width: 72px; flex-shrink: 0; }
    .seat-type-separator {
      text-align: center; font-size: 0.75rem; color: #9ca3af;
      margin: 0.25rem 0; padding-top: 0.5rem;
      border-top: 1px dashed #e5e7eb;
    }
    .seat-new {
      width: 72px; min-height: 62px; flex-shrink: 0;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      gap: 2px; border-radius: 10px; border: 2px solid #e2e8f0;
      background: white; cursor: pointer; transition: all 0.18s;
      padding: 0.3rem;
    }
    .seat-new:hover:not(:disabled) { border-color: #667eea; background: #eef2ff; transform: translateY(-1px); }
    .seat-new.seat-selected  { background: #667eea; border-color: #4f46e5; color: white; }
    .seat-new.seat-booked    { background: #f1f5f9; border-color: #cbd5e1; color: #94a3b8; cursor: not-allowed; }
    .seat-new.seat-is-sleeper { border-radius: 14px; }
    .seat-new.seat-type-seater { background: #f0fdf4; border-color: #bbf7d0; }
    .seat-new.seat-type-seater:hover:not(:disabled) { border-color: #22c55e; background: #dcfce7; }
    .seat-new.seat-type-seater.seat-selected { background: #16a34a; border-color: #15803d; color: white; }
    .seat-number { font-size: 0.7rem; font-weight: 700; line-height: 1; }
    .seat-icon   { font-size: 1rem; line-height: 1; }
    .seat-price  { font-size: 0.65rem; color: #64748b; line-height: 1; }
    .seat-new.seat-selected .seat-price  { color: rgba(255,255,255,0.85); }
    .seat-new.seat-selected .seat-number { color: white; }
    .sold-label  { font-size: 0.6rem; color: #94a3b8; }
    .driver-indicator {
      display: flex; align-items: center; gap: 0.5rem;
      font-size: 0.8rem; color: #64748b; margin-bottom: 0.5rem;
      padding: 0.4rem 0.75rem; background: #f8fafc;
      border-radius: 8px; width: fit-content;
    }
    /* Toggle slider */
    .toggle-switch { position:relative; display:inline-block; width:50px; height:26px; }
    .toggle-switch input { opacity:0; width:0; height:0; }
    .toggle-slider { position:absolute; cursor:pointer; top:0; left:0; right:0; bottom:0;
      background:#ccc; border-radius:26px; transition:.3s; }
    .toggle-slider:before { position:absolute; content:""; height:18px; width:18px;
      left:4px; bottom:4px; background:white; border-radius:50%; transition:.3s; }
    input:checked + .toggle-slider { background:#10b981; }
    input:checked + .toggle-slider:before { transform: translateX(24px); }
    .toggle-label { display:flex; align-items:center; gap:0.5rem; font-size:0.85rem; }
    /* Date pills */
    .date-pill { display:inline-flex; align-items:center; gap:0.3rem; background:#eff6ff;
      color:#3b82f6; border-radius:16px; padding:0.2rem 0.65rem; font-size:0.8rem;
      font-weight:600; border:1px solid #bfdbfe; }
    .date-pill button { background:none; border:none; cursor:pointer; color:#ef4444;
      font-size:0.9rem; line-height:1; padding:0; margin-left:0.1rem; }
  </style>
</head>
<body>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       ADMIN LOGIN MODAL (always on top)
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div id="admin-login-modal">
    <div class="modal-content">
      <div class="modal-logo">
        <div class="lock-icon">üîê</div>
      </div>
      <h2 style="text-align:center;margin-bottom:0.25rem;font-size:1.4rem;font-weight:700;">Admin Access</h2>
      <p style="text-align:center;color:#6b7280;font-size:0.875rem;margin-bottom:1.5rem;">Enter your password to continue</p>
      <form id="admin-login-form" onsubmit="handleAdminLogin(event)">
        <div class="form-group">
          <label class="form-label">Password</label>
          <input type="password" class="form-input" id="admin-password"
                 placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required autofocus>
          <!-- NO hint shown here -->
        </div>
        <button type="submit" class="btn btn-primary btn-block" style="margin-top:0.5rem;">
          Unlock Dashboard ‚Üí
        </button>
      </form>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       EXPORT MODAL
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div id="export-modal">
    <div class="export-modal-box">
      <h3>üì• Download Bookings Excel</h3>
      <p>Choose what data to include in your export.</p>

      <div class="export-option">
        <label>
          <input type="radio" name="export-type" value="all" checked>
          <div>
            <div class="opt-label">All Bookings</div>
            <div class="opt-desc">Download every booking in the system</div>
          </div>
        </label>
        <label>
          <input type="radio" name="export-type" value="filter">
          <div>
            <div class="opt-label">Filter by Date &amp; Route</div>
            <div class="opt-desc">Choose a specific date range and/or bus route</div>
          </div>
        </label>
      </div>

      <div id="export-filter-fields">
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:0.75rem;margin-bottom:0.75rem;">
          <div>
            <label style="font-size:0.8rem;font-weight:600;color:#374151;display:block;margin-bottom:0.3rem;">From Date</label>
            <input type="date" id="export-date-from" class="form-input" style="font-size:0.875rem;">
          </div>
          <div>
            <label style="font-size:0.8rem;font-weight:600;color:#374151;display:block;margin-bottom:0.3rem;">To Date</label>
            <input type="date" id="export-date-to" class="form-input" style="font-size:0.875rem;">
          </div>
        </div>
        <div>
          <label style="font-size:0.8rem;font-weight:600;color:#374151;display:block;margin-bottom:0.3rem;">Bus Route (optional)</label>
          <select id="export-route-filter" class="form-input" style="font-size:0.875rem;">
            <option value="">All Routes</option>
          </select>
        </div>
      </div>

      <div style="display:flex;gap:0.75rem;justify-content:flex-end;margin-top:1rem;">
        <button class="btn btn-outline" onclick="closeExportModal()">Cancel</button>
        <button class="btn btn-success" onclick="executeExport()">‚¨áÔ∏è Download Excel</button>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       PAGE CONTENT (blurred when modal open)
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="admin-page-content">

    <!-- Navbar -->
    <nav class="navbar">
      <div class="container">
        <div class="nav-content">
          <a href="index.html" class="nav-brand">
            <img src="assets/icons/shree-ram-logo.png" alt="Shree Ram Travels" style="height:50px;">
          </a>
          <button class="mobile-menu-btn" id="mobile-menu-btn">‚ò∞</button>
          <ul class="nav-links" id="mobile-menu">
            <li><a href="index.html"   class="nav-link">Home</a></li>
            <li><a href="timings.html" class="nav-link">Bus Timings</a></li>
            <li><a href="admin.html"   class="nav-link active">Admin</a></li>
            <li><button class="btn btn-sm btn-outline" onclick="adminLogout()">Logout</button></li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Admin Header -->
    <div class="admin-header">
      <div class="container px-4">
        <h1 style="color:white;font-size:2rem;">Admin Dashboard</h1>
        <p style="color:var(--slate-300);">Manage schedules, bookings, and pricing</p>
      </div>
    </div>

    <!-- Main Content -->
    <div class="container px-4 py-8">

      <!-- Stats -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-label">Total Revenue</div>
          <div class="stat-value" id="stat-revenue">‚Çπ0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Total Bookings</div>
          <div class="stat-value" id="stat-bookings">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Active Buses</div>
          <div class="stat-value" id="stat-buses">0</div>
        </div>
      </div>

      <div style="text-align:center;margin:1rem 0;display:flex;gap:1rem;justify-content:center;align-items:center;">
        <button class="btn btn-sm" onclick="loadStats()" style="background:#10b981;color:white;padding:0.5rem 1rem;border-radius:6px;font-size:0.875rem;border:none;cursor:pointer;">
          üîÑ Refresh Stats
        </button>
        <button class="btn btn-sm" onclick="resetStatsTemporary()" style="background:#ef4444;color:white;padding:0.5rem 1rem;border-radius:6px;font-size:0.875rem;border:none;cursor:pointer;">
          ‚ö†Ô∏è Reset to Zero
        </button>
      </div>

      <!-- Tabs -->
      <div class="admin-tabs">
        <button class="admin-tab-btn active" onclick="switchAdminTab('schedules', event)">Bus Schedules</button>
        <button class="admin-tab-btn"        onclick="switchAdminTab('bookings', event)">Bookings</button>
        <button class="admin-tab-btn"        onclick="switchAdminTab('pricing', event)">Pricing</button>
        <button class="admin-tab-btn"        onclick="switchAdminTab('buslists', event)">Bus Lists</button>
        <button class="admin-tab-btn"        onclick="switchAdminTab('coupons', event)">Coupons</button>
      </div>

      <!-- Tab: Schedules -->
      <div id="tab-schedules" class="admin-tab-content active">
        <div class="card mb-8">
          <h3 class="summary-title" id="form-title">Add New Schedule</h3>
          <form id="schedule-form">
            <input type="hidden" id="schedule-id">
            <input type="hidden" id="bus-name" value="Shree Ram Travels">
            <div class="form-group">
                <label class="form-label">üöå Bus Type</label>
                <select class="form-input" id="bus-type" required>
                  <option value="AC Sleeper (36)">AC Sleeper (36 sleepers)</option>
                  <option value="AC Seater+Sleeper (8+32)">AC Seater + Sleeper (8 seats + 32 sleepers)</option>
                </select>
              </div>

            <!-- Row 1: Origin & Destination -->
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;">
              <div class="form-group">
                <label class="form-label">üèôÔ∏è Origin City</label>
                <input type="text" class="form-input" id="origin" placeholder="e.g. Dehradun" required>
              </div>
              <div class="form-group">
                <label class="form-label">üèôÔ∏è Destination City</label>
                <input type="text" class="form-input" id="destination" placeholder="e.g. Jaipur" required>
              </div>
            </div>

            <!-- Row 2: Pick Up & Drop Points -->
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;">
              <div class="form-group">
                <label class="form-label">üìç Pick Up Point</label>
                <input type="text" class="form-input" id="pickup-point"
                       placeholder="e.g. ISBT Dehradun, Gate 3" required>
                <small class="text-muted">Exact boarding location for passengers</small>
              </div>
              <div class="form-group">
                <label class="form-label">üìç Drop Point</label>
                <input type="text" class="form-input" id="drop-point"
                       placeholder="e.g. Sindhi Camp Bus Stand, Jaipur" required>
                <small class="text-muted">Exact drop-off location</small>
              </div>
            </div>

            <!-- Row 3: Dates, Departure Time, Time Taken -->
            <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:1rem;">
              <div class="form-group">
                <label class="form-label">üìÖ Bus Dates <span class="required">*</span></label>
                <div id="bus-dates-container" style="border:1px solid #e5e7eb;border-radius:8px;padding:0.75rem;background:#fff;">
                  <div id="selected-dates-list" style="display:flex;flex-wrap:wrap;gap:0.4rem;margin-bottom:0.5rem;min-height:28px;"></div>
                  <input type="date" class="form-input" id="bus-date-picker" style="margin-bottom:0.5rem;" onchange="addBusDate(this.value); this.value=''">
                  <small class="text-muted">Click dates to add multiple. Selected dates shown above.</small>
                </div>
                <input type="hidden" id="bus-dates-json" value="[]">
              </div>
              <div class="form-group">
                <label class="form-label">üïê Departure Time</label>
                <input type="time" class="form-input" id="bus-time" required>
              </div>
              <div class="form-group">
                <label class="form-label">‚è±Ô∏è Time Taken</label>
                <div style="display:flex;gap:0.5rem;align-items:center;">
                  <input type="number" class="form-input" id="duration-hours"
                         placeholder="Hrs" min="0" max="72" style="width:50%;" required>
                  <input type="number" class="form-input" id="duration-minutes"
                         placeholder="Min" min="0" max="59" style="width:50%;">
                </div>
                <small class="text-muted">Hours &amp; Minutes (e.g. 8 hrs 30 min)</small>
              </div>
            </div>

            <!-- Row 4: Price -->
            <div class="form-group">
              <label class="form-label">üí∞ Base Price (‚Çπ) <span class="required">*</span></label>
              <input type="number" class="form-input" id="price" min="0" placeholder="e.g. 1200 (optional)">
              <small class="text-muted">
                Optional ‚Äî if entered, this price will be automatically applied to <strong>all seats</strong>
                (both lower &amp; upper decks) for this route. You can fine-tune per-seat prices in the Pricing tab.
              </small>
            </div>

            <div id="schedule-pricing-preview" style="display:none;margin-top:1rem;"></div>
            <div style="display:flex;gap:0.75rem;flex-wrap:wrap;margin-top:0.5rem;">
              <button type="submit" class="btn btn-primary">üíæ Save Schedule</button>
              <button type="button" class="btn btn-secondary" onclick="resetScheduleForm()">üîÑ Reset Form</button>
            </div>
          </form>
        </div>

        <div class="table-container">
          <table class="table">
            <thead>
              <tr>
                <th>Bus Name</th><th>Route</th><th>Pick Up</th><th>Drop</th><th>Date</th><th>Timing</th><th>Duration</th><th>Price</th><th>Seats</th><th>Actions</th>
              </tr>
            </thead>
            <tbody id="schedules-table-body"></tbody>
          </table>
        </div>
      </div>

      <!-- Tab: Bookings -->
      <div id="tab-bookings" class="admin-tab-content">
        <div class="bookings-toolbar">
          <h3 style="font-size:1.1rem;font-weight:600;color:var(--secondary);margin:0;">All Bookings</h3>
          <button class="btn btn-success" onclick="openExportModal()">
            üì• Download User Excel Sheet
          </button>
        </div>
        <div class="table-container">
          <table class="table">
            <thead>
              <tr>
                <th>Token</th><th>Passenger</th><th>Contact</th><th>Bus Details</th><th>Seats</th><th>Amount</th><th>Status</th><th>Actions</th>
              </tr>
            </thead>
            <tbody id="bookings-table-body"></tbody>
          </table>
        </div>
      </div>

      <!-- Tab: Pricing -->
      <div id="tab-pricing" class="admin-tab-content">
        <div class="tab-header">
          <h2>Seat Pricing Configuration</h2>
          <p class="tab-description">Set pricing per route. Use deck-level defaults or override individual seats.</p>
        </div>

        <!-- Route Selector (unchanged) -->
        <div class="card" style="margin-bottom:2rem;">
          <div class="card-header">
            <h3>Select Route</h3>
            <p class="card-description">Choose a route to configure pricing. Routes with ‚≠ê have custom pricing set.</p>
          </div>
          <div class="card-body">
            <div class="form-group">
              <label for="route-selector">Route</label>
              <select id="route-selector" class="form-control">
                <option value="">Select a route‚Ä¶</option>
              </select>
              <small class="form-help">Routes marked with ‚≠ê have custom pricing.</small>
            </div>
            <div id="pricing-status" style="margin-top:1rem;">
              <div class="alert alert-secondary"><strong>Select a route</strong> to configure pricing.</div>
            </div>
          </div>
        </div>

        <form id="pricing-form">

          <!-- ‚ïê‚ïê Section 1: Deck-Level Pricing ‚ïê‚ïê -->
          <div class="card" style="margin-bottom:2rem;border-left:4px solid #3b82f6;">
            <div class="card-header" style="background:#eff6ff;">
              <h3 style="color:#1d4ed8;">üìã Section 1 ‚Äî Deck Default Prices</h3>
              <p class="card-description">Set one price for all lower seats and one for all upper seats. Per-seat overrides in Section 2 take priority.</p>
            </div>
            <div class="card-body">
              <div style="display:grid;grid-template-columns:1fr 1fr;gap:1.5rem;">
                <div class="pricing-card pricing-card-blue">
                  <div class="pricing-card-header"><span class="pricing-icon">üõèÔ∏è</span><h4>Lower Deck</h4></div>
                  <div class="pricing-card-body">
                    <label for="lower-deck-price">Default price per seat (‚Çπ)</label>
                    <input type="number" id="lower-deck-price" class="form-control pricing-input" min="0" step="1" required placeholder="800" oninput="updateDeckPricePreview()">
                    <small class="pricing-help">Applies to all L1‚ÄìL22 seats unless individually overridden</small>
                  </div>
                </div>
                <div class="pricing-card pricing-card-orange">
                  <div class="pricing-card-header"><span class="pricing-icon">üõèÔ∏è</span><h4>Upper Deck</h4></div>
                  <div class="pricing-card-body">
                    <label for="upper-deck-price">Default price per seat (‚Çπ)</label>
                    <input type="number" id="upper-deck-price" class="form-control pricing-input" min="0" step="1" required placeholder="600" oninput="updateDeckPricePreview()">
                    <small class="pricing-help">Applies to all U1‚ÄìU18 seats unless individually overridden</small>
                  </div>
                </div>
              </div>
              <div id="pricing-preview" class="pricing-preview" style="margin-top:1.5rem;"></div>
            </div>
          </div>

          <!-- ‚ïê‚ïê Section 2: Per-Seat Map ‚ïê‚ïê -->
          <div class="card" style="margin-bottom:2rem;border-left:4px solid #8b5cf6;">
            <div class="card-header" style="background:#f5f3ff;">
              <h3 style="color:#6d28d9;">üó∫Ô∏è Section 2 ‚Äî Per-Seat Price Override</h3>
              <p class="card-description">Optionally set individual prices for specific seats. Leave blank to use deck defaults above.</p>
            </div>
            <div class="card-body">
              <div id="per-seat-map-container">
                <p style="color:#6b7280;text-align:center;padding:2rem 0;">Select a route above to configure per-seat prices.</p>
              </div>
            </div>
          </div>

          <div class="form-actions">
            <button type="submit" class="btn btn-primary">üíæ Save Pricing</button>
            <button type="button" class="btn btn-secondary" onclick="resetAllPricing()">üîÑ Reset All to Defaults</button>
            <button type="button" class="btn btn-outline" onclick="resetRoutePricing()" id="reset-route-btn" style="display:none;">‚Ü©Ô∏è Reset Route to Default</button>
          </div>
        </form>

        <div class="alert alert-info" style="margin-top:2rem;">
          <h4>How Pricing Works:</h4>
          <ul style="margin:0.5rem 0 0 1.5rem;">
            <li><strong>Default Pricing:</strong> Applied to all routes without custom pricing</li>
            <li><strong>Route-Specific Pricing:</strong> Override defaults per route</li>
            <li><strong>Automatic Application:</strong> Applied when customers select seats</li>
            <li><strong>Independent Zones:</strong> Each zone has a fixed price regardless of bus type</li>
          </ul>
        </div>
      </div>

      <!-- Tab: Bus Lists -->
      <div id="tab-buslists" class="admin-tab-content">
        <div class="tab-header">
          <h2>üöå Bus Lists</h2>
          <p class="tab-description">Manage all buses ‚Äî search, filter, and toggle active status for recurring daily schedules.</p>
        </div>

        <div class="card mb-4" style="display:flex;gap:1rem;align-items:center;flex-wrap:wrap;">
          <input type="text" class="form-input" id="buslist-search" placeholder="üîç Search by bus name, route, type‚Ä¶" style="max-width:340px;" oninput="filterBusList()">
          <select class="form-input" id="buslist-filter-type" style="max-width:220px;" onchange="filterBusList()">
            <option value="">All Bus Types</option>
            <option value="AC Sleeper (36)">AC Sleeper (36)</option>
            <option value="AC Seater+Sleeper (8+32)">AC Seater+Sleeper (8+32)</option>
          </select>
          <select class="form-input" id="buslist-filter-status" style="max-width:160px;" onchange="filterBusList()">
            <option value="">All Status</option>
            <option value="active">Active</option>
            <option value="inactive">Inactive</option>
          </select>
          <button class="btn btn-outline" onclick="loadBusListTable()">üîÑ Refresh</button>
        </div>

        <div class="table-container">
          <table class="table">
            <thead>
              <tr>
                <th>Bus Name &amp; Type</th>
                <th>Route</th>
                <th>Pickup / Drop</th>
                <th>Departure</th>
                <th>Duration</th>
                <th>Price</th>
                <th>Seats</th>
                <th>Daily Loop</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="buslist-table-body"></tbody>
          </table>
        </div>
      </div>

      <!-- Tab: Coupons -->
      <div id="tab-coupons" class="admin-tab-content">
        <div class="tab-header">
          <h2>üéüÔ∏è Coupons</h2>
          <p class="tab-description">Create and manage discount coupons for passengers.</p>
        </div>

        <div class="card mb-8">
          <h3 class="summary-title" id="coupon-form-title">‚ûï Add New Coupon</h3>
          <form id="coupon-form">
            <input type="hidden" id="coupon-id">
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;">
              <div class="form-group">
                <label class="form-label">üè∑Ô∏è Coupon Code <span class="required">*</span></label>
                <input type="text" class="form-input" id="coupon-code" placeholder="e.g. SAVE200" required style="text-transform:uppercase;">
                <small class="text-muted">Users will enter this code at checkout</small>
              </div>
              <div class="form-group">
                <label class="form-label">üìù Description</label>
                <input type="text" class="form-input" id="coupon-description" placeholder="e.g. Flat ‚Çπ200 off on all routes">
              </div>
            </div>
            <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:1rem;">
              <div class="form-group">
                <label class="form-label">üí∏ Discount Type <span class="required">*</span></label>
                <select class="form-input" id="coupon-type" required onchange="updateCouponPreview()">
                  <option value="flat">Flat Amount (‚Çπ)</option>
                  <option value="percentage">Percentage (%)</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">üî¢ Discount Value <span class="required">*</span></label>
                <input type="number" class="form-input" id="coupon-value" placeholder="e.g. 200" min="0" required oninput="updateCouponPreview()">
              </div>
              <div class="form-group">
                <label class="form-label">üîÅ Max Usage</label>
                <input type="number" class="form-input" id="coupon-max-usage" placeholder="Leave blank for unlimited" min="1">
              </div>
            </div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;">
              <div class="form-group">
                <label class="form-label">üìÖ Valid From <span class="required">*</span></label>
                <input type="date" class="form-input" id="coupon-start" required>
              </div>
              <div class="form-group">
                <label class="form-label">üìÖ Valid Until <span class="required">*</span></label>
                <input type="date" class="form-input" id="coupon-end" required>
              </div>
            </div>
            <div id="coupon-preview" style="padding:1rem;background:#f0fdf4;border-radius:8px;margin-bottom:1rem;font-size:0.9rem;color:#166534;display:none;"></div>
            <div style="display:flex;gap:0.75rem;flex-wrap:wrap;">
              <button type="submit" class="btn btn-primary">üíæ Save Coupon</button>
              <button type="button" class="btn btn-secondary" onclick="resetCouponForm()">üîÑ Reset</button>
            </div>
          </form>
        </div>

        <div class="table-container">
          <table class="table">
            <thead>
              <tr>
                <th>Code</th><th>Description</th><th>Discount</th><th>Valid Period</th><th>Usage</th><th>Status</th><th>Actions</th>
              </tr>
            </thead>
            <tbody id="coupons-table-body"></tbody>
          </table>
        </div>
      </div>

    </div><!-- /container -->
  </div><!-- /admin-page-content -->

  <!-- Scripts -->
  <script src="js/data.js"></script>
  <script src="js/main.js"></script>
  <script src="js/admin.js"></script>
</body>
</html>